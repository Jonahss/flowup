<head>
  <script src="https://fb.me/react-15.2.1.js"></script>
  <script src="https://fb.me/react-dom-15.2.1.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.13.1/lodash.js"></script>
  <link rel="stylesheet" type="text/css" href="flowupStyle.css">
</head>
<script text/ecmascript>

  var sampleMessages = ['hi', 'yo', 'hello', 'chuckwudi', "it's raining today", 'i just got engaged!', 'that sux :(', "how's it goin?"];

  var Message = React.createClass({
    render: function() {
      return React.createElement('div', {className: "Message"}, this.props.message);
    }
  });

  var Thread = React.createClass({
    render: function() {
      var messagePonents = this.props.messages.map(function(message, key) {
        return React.createElement(Message, {message, key})
      });
      return React.createElement('div', {className: 'Thread'}, messagePonents);
    }
  });

  var Viewbox = React.createClass({
    getInitialState: function() {
      return {pink: 0}
    },
    componentDidUpdate: function(prevProps) {
      console.log('number of messages:', this.props.messagesLength)
      if (this.props.messagesLength > prevProps.messagesLength) {
        this.setState({pink: 1})
      }
    },
    fade: function() {
      let fad = function() {
        this.setState({pink: this.state.pink-1});
      }.bind(this)

      setTimeout(fad, 100);
    },
    render: function() {
      var bgColor = 'white';
      if (this.state.pink > 0) {
        bgColor = 'pink';
        this.fade();
      }

      var style = {
        backgroundColor: bgColor
      }

      thread = React.createElement(Thread, {messages: this.props.messages});
      return React.createElement('div', {className: 'viewbox', style: style}, thread);
    }
  })

  var Textbox = React.createClass({
    render: function() {
      return React.createElement('input', {type: 'textbox', className: 'Textbox'});
    }
  });

  var messages = [_.sample(sampleMessages), _.sample(sampleMessages), _.sample(sampleMessages)]
  var messageStore = {messages: messages, messagesLength: messages.length}

  var createMessage = function() {
    messageStore.messages.unshift(_.sample(sampleMessages))
    messageStore.messagesLength = messageStore.messages.length
    renderView(messageStore)
  }

  var renderView = function(messageStore) {
    var viewbox = React.createElement(Viewbox, messageStore)
    var textbox = React.createElement(Textbox, {viewbox: viewbox})
    ReactDOM.render(React.createElement('div', {}, viewbox, textbox),document.getElementById('reactContainer'))
  }

  window.onload = function() {
    renderView(messageStore)
    setInterval(createMessage,450)
  }
</script>
<body>
  <div id="reactContainer"></div>

</body>
